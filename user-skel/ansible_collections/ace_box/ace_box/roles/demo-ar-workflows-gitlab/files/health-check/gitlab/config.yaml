configs:
  - id: workflowGitlabConnection
    config:
      name: "Gitlab Connection"
      template: gitlab-connection.json
      parameters:
        token:
          type: environment
          name: GITLAB_PRIVATE_TOKEN
        url:
          type: environment
          name: GITLAB_EXTERNAL_ENDPOINT
    type:
      settings:
        schema: app:dynatrace.gitlab.connector:connection
        scope: environment

  # workflow
  - id: validator-workflow
    config:
      name: Gitlab Health Validation
      template: gitlab-validator-wf.json
      skip: false
      parameters:
        #wf related
        wf_description: "Gitlab Health Validation Workflow that ensures availability and pipeline runs"
        wf_isPrivate: false

        gitlab_connection_id:
          configType: app:dynatrace.gitlab.connector:connection
          property: id
          type: reference
          configId: workflowGitlabConnection
    type:
      automation:
        resource: workflow