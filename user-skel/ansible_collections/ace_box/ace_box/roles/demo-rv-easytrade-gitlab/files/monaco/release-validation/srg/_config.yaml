timeseries p95 = percentile(dt.service.request.response_time, 95), by:{dt.entity.service}
| lookup [
  fetch dt.entity.service
  | fieldsAdd tags
  | filter(matchesPhrase(tags,"DT_RELEASE_STAGE:staging"))
  | filter(matchesPhrase(tags,"DT_RELEASE_PRODUCT:easytrade"))
  | filter(matchesPhrase(tags,"[Kubernetes]app:offerservice"))
  | sort lifetime desc
  | summarize svc_id = takeFirst(id)
  ],
  sourceField:dt.entity.service,
  lookupField:svc_id,
  prefix:"svc_"
| filter isNotNull(svc_svc_id)
| fields response_time_95 = (arrayAvg(p95))/1000