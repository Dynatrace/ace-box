---
- hosts: localhost
  connection: local
  become: true
  vars_files:
    - ../ace-box.conf.yml
  vars:
    acebox_mode:                      "{{ acebox['features']['mode'] | default('training') }}"
    feature_activegate:               "{{ acebox['features']['activegate'] | default(false) }}"
    feature_oneagent:                 "{{ acebox['features']['oneagent'] | default(true) }}"
    feature_gitea:                    "{{ acebox['features']['gitea'] | default(false) }}"
    feature_jenkins:                  "{{ acebox['features']['jenkins'] | default(true) }}"
    feature_dashboard:                "{{ acebox['features']['dashboard'] | default(false) }}"
    feature_keptn:                    "{{ acebox['features']['keptn'] | default(false) }}"
    feature_cert_manager:             "{{ acebox['features']['cert_manager'] | default(false) }}"
    feature_gitlab:                   "{{ acebox['features']['gitlab'] | default(false) }}"
    feature_activegatekube:           "{{ acebox['features']['activegatekube'] | default(false) }}"
    feature_awx:                      "{{ acebox['features']['awx'] | default(false) }}"

    dynatrace_tenant_url:             "{{ dynatrace['tenant'] }}" 
    dynatrace_paas_token:             "{{ dynatrace['paastoken'] }}"
    dynatrace_api_token:              "{{ dynatrace['apitoken'] }}"
  roles:
  - role: common
    tags:
      - always
  - role: init
    tags:
      - never
      - init
      # - quality_gates # use cases
      # - auto_remediation # use cases
      - all
  - role: microk8s
    tags:
      - never
      - microk8s
      - all
  - role: helm
    tags:
      - never
      - helm
      - all
  - role: dt-activegate
    tags:
      - never
      - dynatrace
      - all
  - role: dt-oneagent
    tags:
      - never
      - dynatrace
      - all
  - role: gitea
    tags:
      - never
      - gitea
      - all
  - role: gitlab
    tags:
      - never
      - gitlab
      - all
  - role: repositories
    tags:
      - never
      - repositories
      - all
  - role: monaco
    tags:
      - never
      - monaco
      - all
  - role: keptn
    tags:
      - never
      - keptn
      - all
  - role: jenkins
    tags:
      - never
      - jenkins
      - all
  - role: awx
    tags:
      - never
      - awx
      # - all
  - role: dashboard
    tags:
      - never
      - dashboard
      - all
  - role: post-install
    tags:
      - never
      - all
