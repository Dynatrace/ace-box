---
- hosts: localhost
  connection: local
  become: true
  vars_files:
    - ../ace-box.conf.yml
  vars:
    acebox_mode:                      "{{ acebox['features']['mode'] | default('training') }}"
    dynatrace_tenant_url:             "{{ dynatrace['tenant'] }}" 
    dynatrace_paas_token:             "{{ dynatrace['paastoken'] }}"
    dynatrace_api_token:              "{{ dynatrace['apitoken'] }}"
  roles:
  - role: common
    tags:
      - always
  - role: features
    tags:
      - never
      - gitlab
      - awx
      # - gitea
  - role: init
    tags:
      - never
      - init
      - all
  - role: microk8s
    tags:
      - never
      - microk8s
      - all
  - role: helm
    tags:
      - never
      - helm
      - all
  - role: dt-activegate
    tags:
      - never
      - dynatrace
      - all
  - role: dt-oneagent
    tags:
      - never
      - dynatrace
      - all
  - role: gitea
    tags:
      - never
      - gitea
      - all
  - role: gitlab
    tags:
      - never
      - gitlab
      - all
  - role: repositories
    tags:
      - never
      - repositories
      - all
  - role: monaco
    tags:
      - never
      - monaco
      - all
  - role: keptn
    tags:
      - never
      - keptn
      - all
  - role: jenkins
    tags:
      - never
      - jenkins
      - all
  - role: awx
    tags:
      - never
      - awx
      - all
  - role: dashboard
    tags:
      - never
      - dashboard
      - all
  - role: post-install
    tags:
      - never
      - all
  tasks:
  - name: Uninstall Gitlab
    include_tasks:
      file: roles/gitlab/tasks/uninstall.yml
      apply:
        tags:
          - gitlab_uninstall
    tags:
      - never
      - gitlab_uninstall
  - name: Uninstall Dynatrace ActiveGate
    include_tasks:
      file: roles/dt-activegate/tasks/uninstall.yml
      apply:
        tags:
          - dynatrace_uninstall
    tags:
      - never
      - dynatrace_uninstall
  - name: Uninstall Dynatrace Operator
    include_tasks:
      file: roles/dt-oneagent/tasks/uninstall.yml
      apply:
        tags:
          - dynatrace_uninstall
    tags:
      - never
      - dynatrace_uninstall
