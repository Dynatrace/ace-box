- name: Cert Manager - Add repo
  become_user: "{{ non_root_user }}"
  shell: /snap/bin/helm repo add jetstack https://charts.jetstack.io

- name: Cert Manager - Add Namespace
  shell: /snap/bin/microk8s.kubectl create namespace cert-manager
  ignore_errors: yes

- name: Cert Manager - Add CRD
  shell: /snap/bin/microk8s.kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v1.2.0/cert-manager.crds.yaml
  
- name: Cert Manager - Install cert-manager
  become_user: "{{ non_root_user }}"
  shell: /snap/bin/helm upgrade --install cert-manager --namespace cert-manager jetstack/cert-manager --version v1.2.0

- name: Gitea - Wait for cert-manager to be ready
  shell: /snap/bin/microk8s.kubectl -n cert-manager rollout status deployment cert-manager-webhook

<<<<<<< HEAD:user-skel/ansible/roles/cert-manager/tasks/main.yml
- name: Cert Manager - Create Letsencrypt resources
  block:
    - copy:
        src: letsencrypt.yml
        dest: /tmp/letsencrypt.yml
    - shell: /snap/bin/microk8s.kubectl apply -f /tmp/letsencrypt.yml
=======
- name: Cert Manager - Apply Letsencrypt YAML
  shell: /snap/bin/microk8s.kubectl apply -f /home/{{ non_root_user }}/k8s/letsencrypt.yml
  ignore_errors: yes
>>>>>>> a49ee91 (Rename user home folder template):user-skel/ansible/playbooks/cert_manager_tasks.yaml
