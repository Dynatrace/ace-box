- name: ActiveGate - Get all Synthetic nodes
  uri:
    url: "{{ dynatrace_tenant_url }}/api/v1/synthetic/nodes"
    method: GET
    headers:
      Content-Type: "application/json"
      Authorization: "Api-token {{ dynatrace_api_token }}"
    return_content: no
    status_code: 200, 201, 204
  register: nodes_response_raw
  when: feature_activegate
  until: "{{ nodes_response_raw.json | json_query(synthetic_nodes_query) }}"
  retries: 15
  delay: 10

- set_fact:
    dt_node_id: "{{ nodes_response_raw.json | json_query(synthetic_nodes_query) | first }}"
  when: feature_activegate and nodes_response_raw is defined
