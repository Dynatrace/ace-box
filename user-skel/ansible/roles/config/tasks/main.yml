---
- include: roles/config/tasks/source.yml
  tags:
  - never
  - default

- name: Config - Replace Keptn with Cloud Automation if needed
  set_fact:
    features_enabled_default: ["feature_oneagent", "feature_activegate", "feature_gitea", "feature_jenkins", "feature_dashboard", "feature_cloud_automation"]
  when: (cloud_automation_tenant_url != "None") and (cloud_automation_api_token != "None")
  tags:
  - never
  - default

- name: Config - Enable default features
  include_role:
    name: config
    tasks_from: update
    apply:
      tags:
      - default
  vars:
    ace_config_key: "{{ item }}"
    ace_config_value: true
  loop: "{{ features_enabled_default }}"
  tags:
  - never
  - default

- name: Config - Enable Gitlab
  include_role:
    name: config
    tasks_from: update
    apply:
      tags:
      - gitlab
  vars:
    ace_config_key: "feature_gitlab"
    ace_config_value: true
  tags:
  - never
  - gitlab

- name: Config - Enable AWX
  include_role:
    name: config
    tasks_from: update
    apply:
      tags:
      - awx
  vars:
    ace_config_key: "feature_awx"
    ace_config_value: true
  tags:
  - never
  - awx

- include: roles/config/tasks/source.yml
  tags:
  - always
