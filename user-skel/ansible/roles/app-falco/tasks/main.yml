---
# Deploy falco from github repository
- name: Add falco chart repo
  kubernetes.core.helm_repository:
    name: falcosecurity
    repo_url: "https://falcosecurity.github.io/charts"

- name: repo update
  command:
    cmd: helm repo update

- name: Install Falco
  command:
    cmd: helm install falco falcosecurity/falco --namespace falco --create-namespace

- name: Install falcosidekick using helm
  command:
    cmd: helm install falcosidekick falcosecurity/falcosidekick --namespace falco

- name: Upgrade falcosidekick using helm
  command:
    cmd: helm upgrade falcosidekick falcosecurity/falcosidekick -f {{ role_path }}/files/values.yaml --namespace falco
