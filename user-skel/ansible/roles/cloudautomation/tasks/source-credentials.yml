---
- name: Cloud Automation - Source credentials
  block:
    - shell: /snap/bin/microk8s.kubectl get secret cloud-automation-creds -n {{ cloud_automation_namespace }} -ojsonpath={.data}
      register: cloud_automation_secret_data
    - set_fact:
        cloud_automation_endpoint: "{{ cloud_automation_secret_data.stdout | from_json | json_query('cloud_automation_endpoint') | b64decode }}/api"
        cloud_automation_bridge: "{{ cloud_automation_secret_data.stdout | from_json | json_query('cloud_automation_endpoint') | b64decode }}/bridge"
        cloud_automation_api_token: "{{ cloud_automation_secret_data.stdout | from_json | json_query('cloud_automation_api_token') | b64decode }}"
