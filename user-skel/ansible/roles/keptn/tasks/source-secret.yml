- name: Keptn - Source API token
  block:
    - shell: /snap/bin/microk8s.kubectl get secret keptn-api-token -n {{ keptn_namespace }} -ojsonpath={.data.keptn-api-token} | base64 --decode
      register: keptn_api_token_raw
    - set_fact:
        keptn_api_token: "{{ keptn_api_token_raw.stdout }}"

- name: Keptn - Source Bridge credentials
  block:
    - shell: /snap/bin/microk8s.kubectl get secret bridge-credentials -n {{ keptn_namespace }} -ojsonpath={.data}
      register: keptn_bridge_secret_data
    - set_fact:
        keptn_bridge_password: "{{ keptn_bridge_secret_data.stdout | from_json | json_query('BASIC_AUTH_PASSWORD') | b64decode }}"
        keptn_bridge_user: "{{ keptn_bridge_secret_data.stdout | from_json | json_query('BASIC_AUTH_USERNAME') | b64decode }}"
