---
# Changes with canary deployment tool (e.g. Jenkins, Gitlab)
- set_fact:
    load_gen_endpoint: "{{ ingress_protocol }}://simplenodeservice-canary-gitlab.{{ ingress_domain }}/api/invoke?url=https://www.dynatrace.com"
    load_gen_namespace: "canary-jenkins"

- name: Deploy load gen
  kubernetes.core.helm:
    name: simplenode-load-gen
    chart_ref: "{{ role_path }}/files/load-gen"
    release_namespace: "{{ load_gen_namespace }}"
    create_namespace: true
    wait: true
    wait_timeout: 5m
    values:
      load_gen_endpoint: "{{ load_gen_endpoint }}"
