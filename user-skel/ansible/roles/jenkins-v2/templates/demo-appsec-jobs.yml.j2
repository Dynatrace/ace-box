        jobs:
          - script: >
              folder('demo-appsec')
              description('Check out ${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}/src/branch/master/demo/appsec for more information')
          - script: >
              pipelineJob('demo-appsec/1. Build') {
                parameters {
                  choiceParam('BUILD', ['1','2','3','4','5'], 'Select the build you want to deploy (affects application behavior, github.com/grabnerandi/simplenodeservice for more details)')
                }
                definition {
                  cpsScm {
                    scriptPath('jenkins/build.Jenkinsfile')
                    scm {
                      git {
                          remote { 
                            url('${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}')
                            credentials('git-creds-ace')
                          }
                          branch('*/master')
                      }
                    }
                    lightweight()
                  }
                }
              }
          - script: >
              pipelineJob('demo-appsec/2. Deploy') {
                parameters {
                  stringParam('APP_NAME', 'simplenodeservice', 'The name of the service to deploy.')
                  stringParam('TAG_STAGING', '', 'The image of the service to deploy.')
                  stringParam('BUILD', '', 'The version of the service to deploy.')
                  stringParam('ART_VERSION', '', 'The artefact version and hash to deploy.')
                }
                definition {
                  cpsScm {
                    scriptPath('jenkins/deployStaging.Jenkinsfile')
                    scm {
                      git {
                          remote { 
                            url('${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}')
                            credentials('git-creds-ace')
                          }
                          branch('*/master')
                      }
                    }
                    lightweight()
                  }
                }
              }
          - script: >
              pipelineJob('demo-appsec/3. Test') {
                parameters {
                  stringParam('APP_NAME', 'simplenodeservice', 'The name of the service to deploy.')
                  stringParam('BUILD', '', 'The version of the service to deploy.')
                  stringParam('ART_VERSION', '', 'The artefact version and hash to deploy.')
                }
                definition {
                  cpsScm {
                    scriptPath('jenkins/test_appsec.Jenkinsfile')
                    scm {
                      git {
                          remote { 
                            url('${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}')
                            credentials('git-creds-ace')
                          }
                          branch('*/master')
                      }
                    }
                    lightweight()
                  }
                }
              }
          - script: >
              pipelineJob('demo-appsec/4. Deploy production') {
                parameters {
                  stringParam('APP_NAME', 'simplenodeservice', 'The name of the service to deploy.')
                  stringParam('TAG_STAGING', '', 'The image of the service to deploy.')
                  stringParam('BUILD', '', 'The version of the service to deploy.')
                  stringParam('ART_VERSION', '', 'The artefact version and hash to deploy.')
                }
                definition {
                  cpsScm {
                    scriptPath('jenkins/deployProd.Jenkinsfile')
                    scm {
                      git {
                          remote { 
                            url('${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}')
                            credentials('git-creds-ace')
                          }
                          branch('*/master')
                      }
                    }
                    lightweight()
                  }
                }
              }
          - script: >
              pipelineJob('demo-appsec/Monitoring as Code') {
                definition {
                  cpsScm {
                    scriptPath('jenkins/mac.Jenkinsfile')
                    scm {
                      git {
                          remote { 
                            url('${GIT_PROTOCOL}://${GIT_DOMAIN}/${GITHUB_ORGANIZATION}/${GIT_REPO}')
                            credentials('git-creds-ace')
                          }
                          branch('*/master')
                      }
                    }
                    lightweight()
                  }
                }
              }
