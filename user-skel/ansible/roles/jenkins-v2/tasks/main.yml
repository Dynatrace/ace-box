---
- name: Add chart repo
  kubernetes.core.helm_repository:
    name: jenkins
    repo_url: "https://charts.jenkins.io"

- name: Template Helm values file
  ansible.builtin.template:
    src: jenkins-values.yml.j2
    dest: /tmp/jenkins-values.yml
    owner: "{{ ace_box_user }}"
    group: "{{ ace_box_user }}"
    mode: '0644'

- name: Install
  kubernetes.core.helm:
    name: jenkins
    chart_ref: jenkins/jenkins
    chart_version: "{{ jenkins_helm_chart_version }}"
    release_namespace: "{{ jenkins_namespace }}"
    create_namespace: true
    wait: true
    wait_timeout: 15m
    values_files:
      - /tmp/jenkins-values.yml
