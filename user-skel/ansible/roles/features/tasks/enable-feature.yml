---
- name: Read ace-box.conf.yml
  ansible.builtin.slurp:
    src: /home/{{ non_root_user }}/ace-box.conf.yml
  register: ace_box_conf_yml

- name: Extract ace-box.conf.yml data
  set_fact:
    ace_box_conf: "{{ ace_box_conf_yml['content'] | b64decode | from_yaml }}"

- name: Update ace_box_conf
  ansible.utils.update_fact:
    updates:
    - path: ace_box_conf.acebox.features.{{ feature_to_enable }}
      value: true
  register: updated_ace_box_conf

- name: Write ace-box.conf.yml
  copy:
    content: '{{ updated_ace_box_conf.ace_box_conf | to_nice_yaml(indent=2) }}'
    dest: /home/{{ non_root_user }}/ace-box.conf.yml

- name: Set feature_{{ feature_to_enable }}
  set_fact: { "feature_{{ feature_to_enable }}": true }
