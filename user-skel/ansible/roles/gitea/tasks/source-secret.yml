- name: Gitea - Source Gitea secret
  shell: >
    /snap/bin/microk8s.kubectl -n {{ gitea_namespace }} get secret gitea-admin -o jsonpath='{.data}'
  register: gitea_secret_data

- name: Gitea - Set secrets facts
  set_fact:
    gitea_username: "{{ gitea_secret_data.stdout | from_json | json_query('git_user') | b64decode }}"
    gitea_password: "{{ gitea_secret_data.stdout | from_json | json_query('git_password') | b64decode }}"
    gitea_access_token: "{{ gitea_secret_data.stdout | from_json | json_query('access_token') | b64decode }}"
